<!doctype html>
	<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Bitcoin Jungle | Bull Bitcoin | Order Page</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
	</head>
	<body>
		<div class="container">
			<h1>New Order For Bull Jungle</h1>
			<form id="addOrder">
				<div class="mb-3">
					<label for="apiKey" class="form-label">API Key</label>
					<input type="password" class="form-control" id="apiKey">
					<div class="form-text">Enter your API Key here</div>
				</div>

				<div class="mb-3">
					<label for="fiatAmount" class="form-label">Fiat Amount</label>
					<input type="text" class="form-control" id="fiatAmount">
					<div class="form-text">Enter the amount in fiat</div>
				</div>

				<div class="mb-3">
					<label for="fiatCurrency" class="form-label">Fiat Currency</label>
					<select class="form-control" id="fiatCurrency">
						<option value="">-- Select an Option --</option>
						<option value="CRC">CRC</option>
						<option value="USD">USD</option>
					</select>
				</div>

				<div class="mb-3">
					<label for="satAmount" class="form-label">Sat Amount</label>
					<input type="text" class="form-control" id="satAmount">
					<div class="form-text">Enter the amount of satoshis here</div>
				</div>

				<div class="mb-3">
					<label for="action" class="form-label">Order Type</label>
					<select class="form-control" id="action">
						<option value="">-- Select an Option --</option>
						<option value="BUY">Buy BTC</option>
						<option value="SELL">Sell BTC</option>
						<option value="BILLPAY">Bill Payment</option>
					</select>
				</div>

				<div class="paymentReqContainer" style="display: none;">
					<div class="mb-3">
						<label for="paymentReq" class="form-label">Payment Request</label>
						<textarea class="form-control" id="paymentReq"></textarea>
						<div class="form-text">For BUY orders, enter a lightning invoice. For SELL orders, enter a SINPE Movil number.</div>
					</div>
				</div>

				<div class="billPayContainer" style="display: none;">
					<div class="mb-3">
						<label for="billerCategory" class="form-label">Biller Category</label>
						<input type="text" class="form-control" id="billerCategory">
					</div>

					<div class="mb-3">
						<label for="billerService" class="form-label">Biller Service</label>
						<input type="text" class="form-control" id="billerService">
					</div>

					<div class="mb-3">
						<label for="billerActionType" class="form-label">Biller Action Type</label>
						<input type="text" class="form-control" id="billerActionType">
					</div>

					<div class="mb-3">
						<label for="billerAccountNumber" class="form-label">Biller Account Number</label>
						<input type="text" class="form-control" id="billerAccountNumber">
					</div>
				</div>

				<button id="submit-btn" type="submit" class="btn btn-primary">Create Order Now</button>
			</form>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
		<script>

			const params = (new URL(document.location)).searchParams;
			const key = params.get("key");

			if(key && key.length > 0) {
				document.querySelector("#apiKey").value = key
			}

			const actionEl = document.querySelector("#action")
			const paymentReqContainer = document.querySelector('.paymentReqContainer')
			const billPayContainer = document.querySelector('.billPayContainer')

			actionEl.addEventListener("change", () => {
  				if(actionEl.value === 'BILLPAY') {
  					paymentReqContainer.style.display = 'none'
  					billPayContainer.style.display = 'block'
  				} else {
  					paymentReqContainer.style.display = 'block'
  					billPayContainer.style.display = 'none'
  				}
  			})

  			const submitBtnEl = document.getElementById('submit-btn')

			const formEl = document.querySelector("form#addOrder")

			formEl.addEventListener('submit', async (e) => {
				e.preventDefault()
				
				submitBtnEl.disabled = true

				const apiKey = document.querySelector("#apiKey").value
				const fiatAmount = document.querySelector("#fiatAmount").value
				const fiatCurrency = document.querySelector("#fiatCurrency").value
				const satAmount = document.querySelector("#satAmount").value
				const action = document.querySelector("#action").value
				const paymentReq = document.querySelector("#paymentReq").value
				const billerCategory = document.querySelector("#billerCategory").value
				const billerService = document.querySelector("#billerService").value
				const billerActionType = document.querySelector("#billerActionType").value
				const billerAccountNumber = document.querySelector("#billerAccountNumber").value

				return fetch("/order", {
					"method": "POST",
					"headers": {
						"Content-Type": "application/json; charset=utf-8"
					},
					"body": JSON.stringify({
						apiKey,
						fiatAmount,
						fiatCurrency,
						satAmount,
						action,
						paymentReq,
						billerCategory,
						billerService,
						billerActionType,
						billerAccountNumber,
					})
				})
				.then((res) => res.json())
				.then((data) => {
					if(data.error) {
						alert(data.message)
						return
					} else {
						alert("Order created successfully!")
					}

					formEl.reset()

					if(key && key.length > 0) {
						document.querySelector("#apiKey").value = key
					}
				})
				.catch((err) => {
					alert(err)
				})
				.finally(() => {
					submitBtnEl.disabled = false
				})
			})
		</script>
	</body>
</html>